# 博弈论

## 巴什博奕(Bash Game)

> 给定 $n$ 个物品。两名玩家轮流行动，取走任意 $1$ ~ $k$ 个物品。取走最后一件物品者获胜。两人都采取最优策略，问先手能否必胜。

结论：**若 $(m+1)|n$ ，则先手必败，否则先手必胜**

我们从最简单的情景开始分析

当石子有 $1$ ~ $m$ 个时，毫无疑问，先手必胜

当石子有 $m+1$ 个时，先手无论拿几个，后手都可以拿干净，先手必败

当石子有 $m+2$ ~ $2m$ 时，先手可以拿走几个，剩下 $m+1$ 个，先手必胜

我们不难发现，面临 $m+1$ 个石子的人一定失败

这样的话两个人的最优策略一定是通过拿走石子，使得对方拿石子时还有 $m+1$ 个

我们考虑往一般情况推广

- 设当前的石子数为 $n=k(m+1)+r$

  先手会首先拿走 $r$ 个，接下来假设后手拿走 $x$ 个，先手会拿走 $m+1−x$ 个，这样博弈下去后手最终一定失败

- 设当前的石子数为 $n=k(m+1)$

  假设先手拿 $x$ 个，后手一定会拿 $m+1−x$ 个，这样下去先手一定失败

## Nim游戏

> 给定 $n$ 堆物品，第 $i$ 堆物品有 $A_i$ 个。两名玩家轮流行动，每次可以任选一堆，取走任意多个物品，可把一堆取光，但不能不取。取走最后一件物品者获胜。两人都采取最优策略，问先手能否必胜。

结论：**若 $n$ 堆石子的数量异或和非 $0$ 时，则先手必胜，否则先手必败**

Nim游戏的必败态我们是知道的，就是当前 $n$ 堆石子的数量都为零

设 $a_i$ 表示第 $i$ 堆石子的数量，那么必败态局面就是

$0\ \mathrm{xor}\ 0\ \mathrm{xor}\ 0\ \mathrm{xor}\ ⋯\ \mathrm{xor}\ 0=0$

- 对于先手来说，如果当前局面是

​	$a_1\ \mathrm{xor}\ a_2\ \mathrm{xor}\ a_3\ \mathrm{xor}\ ⋯\ \mathrm{xor}\ a_n=k$

​	那么一定存在某个 $a_i$ ，它的二进制表示在最高位 $k$ 上一定是 $1$

​	我们将 $a_i\ \mathrm{xor}\ k$，这样就变成了

​	$a_1\ \mathrm{xor}\ a_2\ \mathrm{xor}\ a_3\ \mathrm{xor}\ ⋯\ \mathrm{xor}\ a_n\ \mathrm{xor}\ k=0$

​	此时先手必胜

- 对于先手来说，如果当前局面是

​	$a_1\ \mathrm{xor}\ a_2\ \mathrm{xor}\ a_3\ \mathrm{xor}\ ⋯\ \mathrm{xor}\ a_n=0$

​	那么我们不可能将某一个 $a_i$ 异或一个非零数字后使得

​	$a_1\ \mathrm{xor}\ a_2\ \mathrm{xor}\ a_3\ \mathrm{xor}\ ⋯\ \mathrm{xor}\ a_n=0$

​	此时先手必败

## 公平组合游戏ICG

1. 由两名玩家交替行动。
2. 在游戏进程的任意时刻，可以执行的合法行动与轮到哪名玩家无关。
3. 不能行动的玩家判负。

满足上述条件的问题我们称之为ICG

最典型的Nim游戏，就是一种ICG游戏

## 必胜态与必败态

定义P-position与N-position

P-position：必败态(简记为`P`)，即Previous-position,你可以直观的认为处于这种状态的人最后一定会输

N-position：必胜态(简记为`N`)，即Next-position，你可以直观的理解为处于这种状态的人最后一定会赢

这仅仅是最直观的定义

更严谨的定义为：

1. 无法移动的状态(即terminal-position)为P
2. `存在`移动可以进入P的局面为N
3. `所有`移动都会进入N的局面为P

## DAG博弈

> 给定一个有向无环图，图中有一个唯一的起点，在起点上放有一枚棋子。两名玩家交替地把这枚棋子沿有向边进行移动，每次可以移动
> 一步，无法移动者判负。该游戏被称为有向图游戏。

任何一个公平组合游戏都可以转化为有向图游戏。具体方法是，把每个局面看成图中的一个节点，并且从每个局面向沿着合法行动能够到达的下一个局面连有向边。

## Mex运算



## SG函数



SG函数是人们在研究博弈论的道路上迈出的重要一步，它把许多杂乱无章的博弈游戏通过某种规则结合在了一起，使得一类普遍的博弈问题得到了解决。从SG函数开始，我们不再是单纯的同过找规律等方法去解决博弈问题，而是需要学习一些博弈论中基本的定理，来找到他们的共同特点下面我们来正式研究一下SG(Sprague-Grundy)函数

首先定义`mex`运算，这是一种集合中的运算，它表示**最小的不属于集合的非负整数**

例如 $\operatorname{mex}\{1,2,3\}=0$，$\operatorname{mex}\{0,2\}=1$，$\operatorname{mex}\{0,1,2,3\}=4$，$\operatorname{mex}\{\}=0$

对于给定的有向无环图，定义每个点的SG函数为

$\operatorname{SG}(x)=\operatorname{mex}\{\operatorname{SG}(y)|x\ \mathrm{can\ go\ to}\ y\}$

然而单单一个这样的空洞的函数是解决不了问题的，我们需要分析一下它的性质

- 所有汇点的SG函数为0

这个性质比较显然，因为汇点的所有后继状态都是空集

- 当SG(x)=0时,该节点为必败点

由SG函数的性质易知该节点的所有后继节点SG值均不为0，满足必败态的定义

- 当SG(x)≠0,该节点为必胜点

由SG函数的定义可知该节点的后继节点中一定有一个节点SG=0，满足必胜态的定义

这样我们通过最基本的SG值的定义，我们就可以判断出一个状态是必胜态还是必败态

这个问题实际上就是我们前面讲的巴什博奕

如果这个问题再复杂一点呢？

当这个棋盘上有n个棋子的时候呢？

其实它们的分析思路是一样的

当SG(x)=k时，它表明后继状态中含有SG(y)=0…k−1

也就是说，我们从k可以转移到0…k−1中的任何一个状态，而当前共有n个棋子。

这会让你想到什么？

nim取石子游戏！

那我们是不是也可以推出：

如果在nim游戏中的n堆石子的SG值异或和不为0就说明先手必胜呢？

这是肯定的，因为当你打出nim游戏的SG值表时就会发现

SG(0)=0

SG(1)=mex{SG(0)}=1

SG(2)=mex{SG(1),SG(0)}=2

··· ···

SG(n)=n

是不是很神奇？
